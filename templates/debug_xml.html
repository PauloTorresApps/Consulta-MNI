{% extends "base.html" %}

{% block title %}Debug XML - Processo {{ numero_processo }}{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Debug XML SOAP</h2>
    <p class="subtitle">Processo: {{ numero_processo }}</p>
</div>

<div class="card">
    <div class="result-actions">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
            ‚Üê Voltar
        </a>
        <button onclick="copiarXML('request')" class="btn btn-primary">
            üìã Copiar Request
        </button>
        <button onclick="copiarXML('response')" class="btn btn-primary">
            üìã Copiar Response
        </button>
    </div>
</div>

{% if xml_data.request_xml %}
<div class="card">
    <h3>üì§ Request XML (Envelope SOAP Enviado)</h3>
    <div class="xml-container">
        <pre id="requestXML" class="xml-content">{{ xml_data.request_xml }}</pre>
    </div>
</div>
{% endif %}

{% if xml_data.response_xml %}
<div class="card">
    <h3>üì• Response XML (Envelope SOAP Recebido)</h3>
    <div class="xml-container">
        <pre id="responseXML" class="xml-content">{{ xml_data.response_xml }}</pre>
    </div>
</div>
{% endif %}

{% if xml_data.error %}
<div class="card">
    <h3>‚ùå Erro</h3>
    <div class="alert alert-error">
        {{ xml_data.error }}
    </div>
</div>
{% endif %}

<div class="card info-card">
    <h3>‚ÑπÔ∏è Sobre o Debug XML</h3>
    <ul>
        <li>O <strong>Request XML</strong> mostra o envelope SOAP enviado ao servi√ßo</li>
        <li>O <strong>Response XML</strong> mostra o envelope SOAP recebido como resposta</li>
        <li>Use este modo para debugar problemas de comunica√ß√£o ou validar a estrutura SOAP</li>
        <li>Voc√™ pode copiar os XMLs para an√°lise em ferramentas externas</li>
    </ul>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Fun√ß√£o para copiar XML para √°rea de transfer√™ncia
function copiarXML(tipo) {
    const elementId = tipo === 'request' ? 'requestXML' : 'responseXML';
    const element = document.getElementById(elementId);
    
    if (!element) {
        alert('XML n√£o encontrado!');
        return;
    }
    
    const texto = element.textContent;
    
    navigator.clipboard.writeText(texto).then(function() {
        alert('XML copiado para √°rea de transfer√™ncia!');
    }, function(err) {
        // Fallback para navegadores antigos
        const textarea = document.createElement('textarea');
        textarea.value = texto;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('XML copiado para √°rea de transfer√™ncia!');
    });
}

// Syntax highlighting b√°sico para XML
document.addEventListener('DOMContentLoaded', function() {
    const xmlElements = document.querySelectorAll('.xml-content');
    
    xmlElements.forEach(function(element) {
        let xml = element.textContent;
        
        // Destacar tags
        xml = xml.replace(/(&lt;\/?)(\w+)(.*?)(&gt;)/g, function(match, p1, p2, p3, p4) {
            return '<span class="xml-tag">' + p1 + p2 + '</span>' + 
                   '<span class="xml-attr">' + p3 + '</span>' + 
                   '<span class="xml-tag">' + p4 + '</span>';
        });
        
        // Destacar valores de atributos
        xml = xml.replace(/="(.*?)"/g, '="<span class="xml-value">$1</span>"');
        
        element.innerHTML = xml;
    });
});
</script>
{% endblock %}
